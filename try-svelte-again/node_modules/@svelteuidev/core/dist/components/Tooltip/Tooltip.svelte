<script>import { createEventDispatcher, onMount } from 'svelte';
import { Box } from '../Box';
import { Popper } from '../Popper';
import useStyles from './Tooltip.styles';
export let use = [], element = undefined, className = '', override = {}, label = null, opened = null, openDelay = 0, closeDelay = 0, color = 'gray', radius = 'sm', disabled = false, arrowSize = 2, width = 'auto', wrapLines = false, allowPointerEvents = false, tooltipRef = null, tooltipId = null, 
/** --------PopperProps--------------------------------------- */
zIndex = 300, position = 'top', placement = 'center', gutter = 5, withArrow = false, transitionOptions = { duration: 100 };
export { className as class };
const dispatch = createEventDispatcher();
let openTimeoutRef, closeTimeoutRef;
let _opened = false;
let tooltipRefElement = null;
const handleOpen = (event) => {
    window.clearTimeout(closeTimeoutRef);
    if (openDelay !== 0) {
        openTimeoutRef = window.setTimeout(() => {
            _opened = true;
        }, openDelay);
    }
    else {
        _opened = true;
    }
    dispatch('mouseenter', event);
};
const handleClose = (event) => {
    window.clearTimeout(openTimeoutRef);
    if (closeDelay !== 0) {
        closeTimeoutRef = window.setTimeout(() => {
            _opened = false;
        }, closeDelay);
    }
    else {
        _opened = false;
    }
    dispatch('mouseleave', event);
};
onMount(() => {
    window.clearTimeout(openTimeoutRef);
    window.clearTimeout(closeTimeoutRef);
});
$: visible = (typeof opened === 'boolean' ? opened : _opened) && !disabled;
$: ({ cx, classes, getStyles } = useStyles({ color, radius }, { name: 'Tooltip' }));
</script>

<Box
	bind:element
	on:pointerenter={(event) => handleOpen(event)}
	on:pointerleave={(event) => handleClose(event)}
	on:focus!capture={handleOpen}
	on:blur!capture={handleClose}
	class={cx(className, classes.root, getStyles({ css: override }))}
	{use}
	id={tooltipId}
	{...$$restProps}
>
	<Popper
		{transitionOptions}
		{position}
		{placement}
		{gutter}
		{withArrow}
		{arrowSize}
		{zIndex}
		arrowClassName={classes.arrow}
		reference={tooltipRefElement}
		mounted={visible}
		arrowDistance={3}
	>
		<Box
			bind:this={tooltipRef}
			class={classes.body}
			css={{
				pointerEvents: allowPointerEvents ? 'all' : 'none',
				whiteSpace: wrapLines ? 'normal' : 'nowrap',
				width
			}}
		>
			{#if typeof label === 'function'}
				<svelte:component this={label} />
			{:else if typeof label === 'string'}
				{label}
			{:else if typeof label === 'number'}
				{label}
			{:else if $$slots.label}
				<slot name="label" />
			{:else}
				{label}
			{/if}
		</Box>
	</Popper>
	<span bind:this={tooltipRefElement}>
		<slot />
	</span>
</Box>
